{% extends 'base.html.twig' %}

{% block title %}Sortie index{% endblock %}

{% block body %}
    <h1>Sortie index</h1>

    <table id="datagrid" class="table striped table-border mt-4"
    data-role="table"
           data-rows="5"
           data-rows-steps="5, 10"
           data-show-activity="false"
           data-rownum="true"
           data-check="true"
           data-check-style="2"
           data-table-info-title="Listes des Sorties">
        <thead>
            <tr>
                <th>Nom de la sortie</th>
                <th data-sortable="true" data-sort-dir="asc">Date de la sortie</th>
                <th>Cloture</th>
                <th>NbPlaces</th>
                <th data-sortable="true" data-sort-dir="asc">Etat</th>
                <th>Inscrit</th>
                <th  data-sortable="true" data-sort-dir="asc">Organisateur</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
        {% for sortie in sorties %}
            <tr>
                <td>{{ sortie.nom }}</td>
                <td>{{ sortie.dateDebut ? sortie.dateDebut|date('Y-m-d H:i:s') : '' }}</td>
                <td>{{ sortie.dateCloture ? sortie.dateCloture|date('Y-m-d H:i:s') : '' }}</td>
                <td>{{ sortie.participants | length}} / {{ sortie.nbPlaces }}</td>
                <td>{{ sortie.etat.libelle }}</td>
                <td>
                    {% set userInscrit = false %}
                    {% for participant in sortie.participants %}
                        {% if participant.id == app.user.id %}
                            <span class="mif-cross-light"></span>
                            {% set userInscrit = true  %}
                        {% endif %}
                       
                    {% endfor %}
                </td>
                <td>
                    <a title="Afficher utilisateur" href="{{ path('participant_show', {'id': sortie.organisateur.id}) }}">
                        {{ sortie.organisateur.prenom }} {{ sortie.organisateur.nom }}
                    </a>
                </td>
                <td>
                    <a class="button info" title="Afficher sortie" href="{{ path('sortie_show', {'id': sortie.id}) }}"><span class="mif-eye mif-2x"></span></a>
                    {% if sortie.organisateur.id == app.user.id and sortie.etat.id == 1 %}
                        <a class="button warning" title="Modifier sortie" href="{{ path('sortie_edit', {'id': sortie.id}) }}"><span class="mif-pencil mif-2x"></span></a>
                    {% endif %}
                    {% if sortie.etat.id == 2 and userInscrit == false and  sortie.participants | length < sortie.nbPlaces %}
                        <a class="button warning" title="Inscription" href="{{ path('sortie_inscription', {'action': 'ins', 'idSortie': sortie.id,'idParticipant': app.user.id}) }}"><span class="mif-user-plus mif-2x"></span></a>
                    {% endif %}
                    {% if (sortie.etat.id == 2 or sortie.etat.id == 3)  and userInscrit == true %}
                        <a class="button alert" title="Désinscription" href="{{ path('sortie_inscription', {'action': 'des', 'idSortie': sortie.id,'idParticipant': app.user.id}) }}"><span class="mif-user-minus mif-2x"></span></a>
                    {% endif %}
                </td>

            </tr>
        {% else %}
            <tr>
                <td colspan="8">Aucune sortie de prévu</td>
            </tr>
        {% endfor %}
        </tbody>
    </table>

    <a class="button success" href="{{ path('sortie_new') }}" title="Créer une nouvelle Sortie"><span class="mif-plus"></span></a>
{% endblock %}
